<script>
document.addEventListener('DOMContentLoaded', function() {
    const timeline = document.querySelector('.widget-archive--timeline');
    const backButton = document.querySelector('.timeline-back-button');
    let currentPosition = 0;

    if (timeline && backButton) {
        const currentDate = new Date();
        const currentYear = currentDate.getFullYear();
        const currentMonth = currentDate.getMonth() + 1;
        const currentDay = currentDate.getDate();

        const yearItems = timeline.querySelectorAll('.timeline-item');
        let currentYearItem;
        yearItems.forEach(item => {
            const yearText = item.querySelector('.timeline-title').textContent;
            const year = parseInt(yearText);
            if (year === currentYear) {
                currentYearItem = item;
            }
        });

        if (currentYearItem) {
            const currentDateMarker = document.createElement('div');
            currentDateMarker.className = 'timeline-current-date';
            currentDateMarker.setAttribute('data-date', `${currentYear}-${currentMonth.toString().padStart(2, '0')}-${currentDay.toString().padStart(2, '0')}`);
            
            const markerPosition = currentYearItem.offsetTop + (currentYearItem.offsetHeight * (currentMonth - 1) / 12);
            currentDateMarker.style.top = `${markerPosition}px`;
            
            timeline.appendChild(currentDateMarker);
            currentPosition = markerPosition - timeline.offsetHeight / 2;
            timeline.scrollTop = currentPosition;
        }

        timeline.addEventListener('scroll', function() {
            if (Math.abs(timeline.scrollTop - currentPosition) > timeline.offsetHeight) {
                backButton.style.display = 'block';
            } else {
                backButton.style.display = 'none';
            }
        });

        backButton.addEventListener('click', function() {
            timeline.scrollTo({
                top: currentPosition,
                behavior: 'smooth'
            });
        });
    }
});
</script>
